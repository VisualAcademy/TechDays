var spritify=function(){function n(n){this.options=n,this._lastUpdateFrame=(new Date).getTime(),this._finishingFrames=!1,this.Destroyed=!1,this.Playing=!1,this.spritifyAnimate(),this.Position=new Vector2(this.options.X,this.options.Y),this.Rotation=this.options.Rotation}return n.prototype.getFramePosition=function(n,t,i){var r=i.Width/t.Width,e=i.Height/t.Height,u=Math.floor(n/r),f=Math.ceil(n%r);return{row:u,column:f}},n.prototype.initiateAnimation=function(){this.Playing=!0,this.nextAnimationFrame()},n.prototype.nextAnimationFrame=function(){var n=this;if(++this.options.currentFrame>=this.options.frameCount){if(this._finishingFrames){this.options.currentFrame-1<this.options.frameCount+this.options.finalFrames?this.options.autoPlay&&(this.options.timeoutID=setTimeout(this.nextAnimationFrame,this.options.interval)):(this._finishingFrames=!1,this.Stop());return}this.options.destroyOncePlayed&&(this.Destroyed=!0,this.Playing=!1),this.options.loop?this.options.currentFrame=this.options.loopFrom:(this.Playing=!1,this.options.deferred.resolve())}this.Playing&&this.options.autoPlay&&(this.options.timeoutID=setTimeout(function(){n.nextAnimationFrame()},this.options.interval))},n.prototype.ClearDrawOnCanvas=function(){this.options.drawOn.clearRect(this.Position.X,this.Position.Y,this.options.frameSize.Width,this.options.frameSize.Height)},n.prototype.Play=function(){this.Playing||(this._finishingFrames=!1,this.initiateAnimation())},n.prototype.Pause=function(){this.Playing&&(this.Playing=!1,clearTimeout(this.options.timeoutID))},n.prototype.Stop=function(n){this.Playing&&(n?this._finishingFrames=!0:(this.Playing=!1,this.options.currentFrame=0,this.ClearDrawOnCanvas(),clearTimeout(this.options.timeoutID)))},n.prototype.spritifyAnimate=function(){this.options=$.extend({centerOn:null,startFrame:0,fps:this.options.frameCount,loop:!1,loopFrom:0,destroyOncePlayed:!0,Rotation:0,X:0,Y:0,drawOn:!1,autoPlay:!0,autoClear:!0,finalFrames:0,deferred:$.Deferred()},this.options),this.options.destroyOncePlayed=this.options.loop===!1?this.options.destroyOncePlayed:!1,this.options.currentFrame=this.options.startFrame,this.options.interval=1e3/this.options.fps,this.options.frameCount||(this.options.frameCount=this.options.spriteSheetSize.Width/this.options.frameSize.Width*(this.options.spriteSheetSize.Height/this.options.frameSize.Height),this.options.fps||(this.options.fps=this.options.frameCount)),this.options.centerOn&&(this.options.X=this.options.centerOn.X-.5*this.options.frameSize.Width,this.options.Y=this.options.centerOn.Y-.5*this.options.frameSize.Height),this.options.autoPlay&&this.initiateAnimation()},n.prototype.Update=function(n){if(!this.options.autoPlay&&this.Playing){var t=n.getTime();this.Playing&&t-this._lastUpdateFrame>=this.options.interval&&(this.nextAnimationFrame(),this._lastUpdateFrame=t)}},n.prototype.Draw=function(){if(this.Playing&&!this.Destroyed){var n=this.getFramePosition(this.options.currentFrame,this.options.frameSize,this.options.spriteSheetSize);this.options.drawOn?(this.options.autoClear&&this.ClearDrawOnCanvas(),this.options.drawOn.drawImage(this.options.image,n.column*this.options.frameSize.Width,n.row*this.options.frameSize.Height,this.options.frameSize.Width,this.options.frameSize.Height,this.Position.X,this.Position.Y,this.options.frameSize.Width,this.options.frameSize.Height)):CanvasContext.drawRotatedImage(this.options.image,this.Rotation,n.column*this.options.frameSize.Width,n.row*this.options.frameSize.Height,this.options.frameSize.Width,this.options.frameSize.Height,this.Position.X,this.Position.Y,this.options.frameSize.Width,this.options.frameSize.Height)}},n.prototype.On=function(){return this.options.deferred.promise()},n}()