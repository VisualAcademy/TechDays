var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},ShipMovementController=function(n){function t(){n.call(this,t.MASS,t.ENGINE_POWER),this._acceleration=Vector2.Zero(),this.Moving={Forward:!1,Backward:!1,RotatingLeft:!1,RotatingRight:!1},this.StopMovement()}return __extends(t,n),t.MASS=0,t.ENGINE_POWER=0,t.DRAG_AREA=0,t.DRAG_COEFFICIENT=0,t.ROTATE_SPEED=0,t.MOVING_DIRECTIONS=["RotatingLeft","RotatingRight","Forward","Backward"],t.INTERPOLATE_POSITION_THRESHOLD=10,t.INTERPOLATE_ROTATION_THRESHOLD=15,t.prototype.interpolate=function(n,i){if(this.Smoothing[n]){var u=CalculatePO(this.LastUpdated,this.InterpolateOver[n]),r=this.Target[n]-this.Position[n];Math.abs(r)<=t.INTERPOLATE_POSITION_THRESHOLD?this.Smoothing[n]=!1:(this.Target[n]+=i[n],this.Position[n]+=r*u)}},t.prototype.interpolateRotation=function(n){var r,i;this.SmoothingRotation&&(r=CalculatePO(this.LastUpdated,this.InterpolateRotationOver),this.TargetRotation+=n,i=this.TargetRotation-this.Rotation,this.Rotation+=i*r,Math.abs(i)<=t.INTERPOLATE_ROTATION_THRESHOLD&&(this.SmoothingRotation=!1))},t.prototype.tryInterpolation=function(n){this.InterpolateOver&&(this.interpolate("X",n),this.interpolate("Y",n))},t.prototype.tryInterpolationRotation=function(n){this.InterpolateRotationOver&&this.interpolateRotation(n)},t.prototype.StopMovement=function(){for(var n=t.MOVING_DIRECTIONS.length-1;n>=0;n--)this.Moving[t.MOVING_DIRECTIONS[n]]=!1},t.prototype.Move=function(n,i){var r,u=Vector2.Zero(),s=i.getTime();this._acceleration=Vector2.DivideVByN(this.Forces,this.Mass),u=Vector2.AddV(Vector2.MultiplyN(this.Velocity,n),Vector2.MultiplyN(this._acceleration,n*n)),this.Position.AddV(u),this.tryInterpolation(u),this.Velocity.AddV(Vector2.MultiplyN(this._acceleration,n)),r=this.Velocity.Length(),r<10?this.Velocity.ZeroOut():r>3e3&&(this.Velocity=Vector2.MultiplyN(new Vector2(this.Rotation,!1),600)),this._acceleration.ZeroOut(),this.Forces.ZeroOut();var f=n*t.ROTATE_SPEED,e=new Vector2(this.Rotation,!1),o=Vector2.MultiplyN(Vector2.MultiplyV(Vector2.MultiplyN(this.Velocity,.5),this.Velocity.Abs()),t.DRAG_COEFFICIENT*t.DRAG_AREA*-1);this.Moving.RotatingLeft&&(this.Rotation-=f),this.Moving.RotatingRight&&(this.Rotation+=f),this.Moving.Forward&&this.ApplyForce(Vector2.MultiplyN(e,this.Power)),this.Moving.Backward&&this.ApplyForce(Vector2.MultiplyN(e,this.Power*-1)),this.ApplyForce(o)},t.prototype.Update=function(t,i){t>0&&(this.Move(t,i),n.prototype.Update.call(this,t,i))},t.prototype.UpdateMovementController=function(t){n.prototype.UpdateMovementController.call(this,t)},t}(MovementController)