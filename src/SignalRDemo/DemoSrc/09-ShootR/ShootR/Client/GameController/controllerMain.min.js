$(window).load(function(){function s(n){$.extend(GameScreen,n.Configuration.screenConfig),f.gameConfig={UPDATE_INTERVAL:n.Configuration.gameConfig.UPDATE_INTERVAL},r.Initialize(),h(),i=new TouchController(t.StartMovement,t.StopMovement,t.StopAndStartMovement,t.ResetMovement,t.shoot),i.Initialize(r)}function h(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,f.gameConfig.UPDATE_INTERVAL)}}(),function n(){window.requestAnimFrame(n),i&&c()}()}function c(){CanvasContext.clear(),i.Draw(),CanvasContext.Render()}var n=$.connection.h,f={},r=new GameScreen($("#game"),$("#gameWrapper"),!1,n),t=new ShipControllerFunctions(n),i;r.SendNewViewportToServer=function(){};var e=$.cookie("shootr.state"),u=e?JSON.parse(e):{},o=u.RegistrationID;n.client.stopController=function(n){$.connection.hub.stop(),alert(n)},n.client.disconnect=function(){$.connection.hub.stop(),alert("You have been disconnected for being Idle for too long.")},o&&(delete u.RegistrationID,$.cookie("shootr.state",JSON.stringify(u),{path:"/",expires:30}),$.connection.hub.start(function(){n.server.initializeController(o).done(function(n){n.FailureMessage?(alert(n.FailureMessage),$.connection.hub.stop()):s(n)})})),$("#logout").click(function(){for(var t=document.cookie.split(";"),i,r,n=0;n<t.length;n++)i=t[n].indexOf("="),r=i>-1?t[n].substr(0,i):t[n],document.cookie=r+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT";window.location.href=window.location.href})})