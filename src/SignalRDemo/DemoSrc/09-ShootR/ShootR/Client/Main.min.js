$(function(){function l(i){if(i!=null){if(i.ServerFull){$.connection.hub.stop(),alert("Server is full, try refreshing the page in 5 minutes.");return}f=new ConfigurationManager(i.Configuration),n=new Game(t,u,i.ShipID),GAME_GLOBALS.Game=n,r.LoadContracts(i.CompressionContracts),n.HUDManager.Initialize(),e.Initialize(n.HUDManager),n.ShipManager.MyShip.LatencyResolver=u,n.ShipManager.MyShip.Initialize(e),a(),t.server.readyForPayloads()}else alert("Refresh your page")}function a(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,f.gameConfig.UPDATE_INTERVAL)}}(),function t(){window.requestAnimFrame(t),o&&n.Update(s)}()}function v(t){var i=n.ShipManager.MyShip;t.ShipsOnScreen=n.ShipManager.Ships,s=t,t.Notification&&n.HUDManager.NotificationManager.Notify(t.Notification,!1),t.KilledByName&&(n.HUDManager.DeathScreen.YouDied.call(n.HUDManager.DeathScreen,t.KilledByName,t.KilledByPhoto),n.ShipManager.MyShip.MovementController.StopMovement()),i.Experience=t.Experience,i.ExperienceToNextLevel=t.ExperienceToNextLevel,n.HUDManager.MyRankings.LoadPosition(t.LeaderboardPosition,t.ShipsInWorld),n.ShipManager.MyShip.Update(),n.ShipManager.MyShip.PayloadReceived(t),n.ShipManager.UpdateShips(t.Ships),n.PowerupManager.UpdatePowerups(t.Powerups,n.GameTime),n.ShipManager.MyShip.ReplayCommands(t.LastCommandProcessed),n.BulletManager.UpdateBullets(t.Bullets),o=!0}var t=$.connection.h,n,f,r=new PayloadDecompressor,u=new LatencyResolver(t),e=new GameScreen($("#game"),$("#gameWrapper"),$("#popUpHolder"),t),y=$("#Notification"),o=!1,s={Ships:{},Bullets:[]},h=$.cookie("shootr.state"),i=h?JSON.parse(h):{},c=i.RegistrationID;t.client.d=function(n){v(r.Decompress(n))},t.client.l=function(t){n.HUDManager.Leaderboard.Load(r.DecompressLeaderboard(t))},t.client.mapSizeIncreased=function(t){Map.WIDTH=t.Width,Map.HEIGHT=t.Height,n.HUDManager.OnMapResize(t)},t.client.notify=function(n){alert(n)},t.client.disconnect=function(){n.HUDManager.NotificationManager.Notify("You have been disconnected for being Idle too long.  Refresh the page to play again.",!0),$.connection.hub.stop()},t.client.controlTransferred=function(){n.HUDManager.NotificationManager.Notify("You have been disconnected!  The control for your ship has been transferred to your other login.",!0),$.connection.hub.stop()},t.client.pingBack=function(){u.ServerPingBack()},c&&(delete i.RegistrationID,$("#DisplayName").html(i.DisplayName),$("#DisplayNameLB").html(i.DisplayName),$("#You").attr("src",i.Photo),$("#YouLB").attr("src",i.Photo),$.cookie("shootr.state",JSON.stringify(i),{path:"/",expires:30}),$.connection.hub.start(function(){t.server.initializeClient(c).done(function(n){l(n)})})),$("#logout").click(function(){for(var t=document.cookie.split(";"),i,r,n=0;n<t.length;n++)i=t[n].indexOf("="),r=i>-1?t[n].substr(0,i):t[n],document.cookie=r+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT";window.location.href=window.location.href})})