var LatencyResolver=function(){function n(n){this._connection=n,this.SampleSize=10,this.Latency="...",this._pingCount=0,this._deltas=[],this._CST=new ClientServerTime,this._requestedPingAt=!1}return n.prototype.calculateDeltaTime=function(n,t){var i=(new Date).getTime(),r=this.CalculateLatencySince(n);return i-t+r},n.prototype.pushPingResults=function(n,t){this._deltas.push(this.calculateDeltaTime(n,t))},n.prototype.RequestedPingBack=function(){this._requestedPingAt||(this._requestedPingAt=(new Date).getTime())},n.prototype.ServerPingBack=function(){this._requestedPingAt&&(this.Latency=this.CalculateLatencySince(this._requestedPingAt)+" ms",this._requestedPingAt=!1)},n.prototype.ResolveFromAcknowledgement=function(n,t){this.pushPingResults(n,t),this._deltas.length===this.SampleSize&&(this._CST.Delta=this.GenerateDeltaTime(),this._deltas=[])},n.prototype.CalculateLatencySince=function(n){return((new Date).getTime()-n)/2},n.prototype.Resolve=function(n){function i(){var r=(new Date).getTime();this.connection.server.ping().done(function(u){t.pushPingResults(r,this._CST.GetServerTime(new Date(u).getTime())),++t._pingCount<t.SampleSize?i():t._pingCount===1?t._CST.Delta=t._deltas[0]:(t._CST.Delta=t.GenerateDeltaTime(),t._deltas=[],n())})}var t=this;this._deltas=[],this._connection.server.ping().done(i)},n.prototype.GenerateDeltaTime=function(){var t,i,n;for(this._deltas.sort(),t=StandardDeviation(this._deltas),i=this._deltas[Math.floor(this._deltas.length/2)],n=0;n<this._deltas.length;n++)Math.abs(this._deltas[n]-i)>=t&&this._deltas.splice(n--,1);return Math.round(Average(this._deltas))},n}()